# 📧 配置邮箱接收 AI 新闻推送 - 完整指南

## 📊 当前邮件配置状态

系统已经集成了邮件服务，使用 **Resend** 作为邮件发送服务。

当前配置：
```
EMAIL_FROM=noreply@yourdomain.com
EMAIL_TO=your-email@example.com
RESEND_API_KEY=your-resend-api-key-here
ENABLE_EMAIL=True
```

## 🚀 配置步骤

### 方法 1: 使用 Resend（推荐）⭐

Resend 是一个现代化的邮件发送服务，免费额度足够个人使用。

#### 步骤 1: 注册 Resend 账号

1. **访问** https://resend.com/
2. **点击 "Sign Up"** 注册账号
3. **验证邮箱**

#### 步骤 2: 获取 API Key

1. **登录 Resend 控制台**
2. **进入 "API Keys"** 页面
3. **点击 "Create API Key"**
4. **复制生成的 API Key**（格式类似：`re_xxxxxxxxxxxxx`）

#### 步骤 3: 配置域名（可选）

**选项 A: 使用 Resend 提供的测试域名**
- 免费，无需配置
- 发件人：`onboarding@resend.dev`
- 适合测试和个人使用

**选项 B: 使用自己的域名**
- 需要添加 DNS 记录
- 更专业的发件人地址
- 适合生产环境

#### 步骤 4: 修改 .env 配置文件

```bash
cd /Users/pingxn7/Desktop/x/backend
nano .env
```

修改以下配置：

```bash
# Email Service (Resend)
RESEND_API_KEY=re_你的API_Key  # 替换为实际的 API Key
EMAIL_FROM=onboarding@resend.dev  # 使用 Resend 测试域名
EMAIL_TO=你的邮箱@example.com  # 替换为您的邮箱地址

# Feature Flags
ENABLE_EMAIL=True  # 确保邮件功能已启用
```

#### 步骤 5: 重启 API 服务器

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 方法 2: 使用其他邮件服务

如果您想使用其他邮件服务（如 Gmail、SendGrid 等），需要修改邮件服务代码。

---

## 📝 配置示例

### 示例 1: 使用 Resend 测试域名

```bash
# .env 文件配置
RESEND_API_KEY=re_abc123def456ghi789  # 您的 Resend API Key
EMAIL_FROM=onboarding@resend.dev
EMAIL_TO=your-email@gmail.com  # 您的邮箱
ENABLE_EMAIL=True
```

### 示例 2: 使用自己的域名

```bash
# .env 文件配置
RESEND_API_KEY=re_abc123def456ghi789
EMAIL_FROM=ai-news@yourdomain.com  # 您的域名
EMAIL_TO=your-email@gmail.com
ENABLE_EMAIL=True
```

---

## 🎯 测试邮件发送

### 方法 1: 手动触发每日摘要生成

```bash
cd /Users/pingxn7/Desktop/x/backend
source venv/bin/activate

# 运行每日摘要任务
python -c "
import asyncio
from app.tasks.daily_summary import create_daily_summary
from app.database import SessionLocal

async def test():
    db = SessionLocal()
    try:
        await create_daily_summary(db)
    finally:
        db.close()

asyncio.run(test())
"
```

### 方法 2: 创建测试脚本

我可以为您创建一个测试脚本来验证邮件配置。

---

## 📧 邮件内容预览

您将收到的邮件包含：

### 邮件标题
```
AI News Digest - 2026-02-08 | 今日精选10条
```

### 邮件内容
- **今日关键亮点** - AI 领域的重要进展总结
- **今日精选** - Top 10 最重要的推文
  - 账号名称
  - 推文摘要
  - 互动数据（点赞、转发、回复）
- **查看完整汇总** - 链接到前端页面
- **统计信息** - 收集的推文总数

---

## ⏰ 邮件发送时间

当前配置：
```bash
SCHEDULE_DAILY_SUMMARY_CRON=0 8 * * *  # 每天早上 8 点（UTC）
SCHEDULE_TIMEZONE=UTC
```

**转换为北京时间：**
- UTC 8:00 = 北京时间 16:00（下午 4 点）

**如果想改为北京时间早上 8 点：**
```bash
SCHEDULE_DAILY_SUMMARY_CRON=0 0 * * *  # UTC 0:00 = 北京时间 8:00
```

---

## 🔧 快速配置命令

### 一键配置脚本

```bash
cd /Users/pingxn7/Desktop/x/backend

# 备份原配置
cp .env .env.backup

# 使用 sed 修改配置（替换为您的实际值）
sed -i '' 's/RESEND_API_KEY=.*/RESEND_API_KEY=re_your_api_key_here/' .env
sed -i '' 's/EMAIL_FROM=.*/EMAIL_FROM=onboarding@resend.dev/' .env
sed -i '' 's/EMAIL_TO=.*/EMAIL_TO=your-email@gmail.com/' .env
sed -i '' 's/ENABLE_EMAIL=.*/ENABLE_EMAIL=True/' .env

# 查看修改后的配置
grep -E "RESEND_API_KEY|EMAIL_FROM|EMAIL_TO|ENABLE_EMAIL" .env
```

---

## ✅ 验证配置

### 检查配置是否正确

```bash
cd /Users/pingxn7/Desktop/x/backend
source venv/bin/activate

python -c "
from app.config import settings
print(f'Email enabled: {settings.enable_email}')
print(f'Resend API Key: {settings.resend_api_key[:10]}...' if settings.resend_api_key else 'Not set')
print(f'Email from: {settings.email_from}')
print(f'Email to: {settings.email_to}')
"
```

---

## 🎯 完整配置流程（推荐）

### 步骤 1: 注册 Resend（5 分钟）

1. 访问 https://resend.com/
2. 注册账号并验证邮箱
3. 获取 API Key

### 步骤 2: 修改配置（2 分钟）

```bash
cd /Users/pingxn7/Desktop/x/backend
nano .env
```

修改这 3 行：
```bash
RESEND_API_KEY=re_你的API_Key
EMAIL_FROM=onboarding@resend.dev
EMAIL_TO=你的邮箱地址
```

保存并退出（Ctrl+X, Y, Enter）

### 步骤 3: 重启服务器（1 分钟）

```bash
# 如果服务器正在运行，先停止（Ctrl+C）
# 然后重新启动
source venv/bin/activate
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 步骤 4: 等待自动发送或手动测试

**选项 A: 等待自动发送**
- 下次摘要生成时间：2026-02-09 08:00 (UTC) = 北京时间 16:00

**选项 B: 手动触发测试**
- 我可以帮您创建一个测试脚本

---

## 🆘 常见问题

### Q1: 我没有收到邮件怎么办？

**检查清单：**
1. 检查垃圾邮件文件夹
2. 确认 RESEND_API_KEY 配置正确
3. 确认 EMAIL_TO 是您的邮箱地址
4. 确认 ENABLE_EMAIL=True
5. 查看服务器日志是否有错误

### Q2: 如何修改邮件发送时间？

编辑 .env 文件：
```bash
# 改为每天早上 9 点（UTC）
SCHEDULE_DAILY_SUMMARY_CRON=0 9 * * *

# 改为每天早上 8 点（北京时间）
SCHEDULE_DAILY_SUMMARY_CRON=0 0 * * *
```

### Q3: 可以发送到多个邮箱吗？

目前只支持单个邮箱。如需发送到多个邮箱，需要修改代码。

### Q4: 邮件是中文还是英文？

邮件内容是中英文混合：
- 标题：中英文
- 内容：主要是中文
- 推文：原文（英文为主）

### Q5: 如何测试邮件发送？

我可以为您创建一个测试脚本。

---

## 💡 我的建议

**推荐配置方案：**

1. **使用 Resend 免费版**
   - 每月 3,000 封邮件（足够个人使用）
   - 无需信用卡
   - 配置简单

2. **使用测试域名**
   - 无需配置 DNS
   - 立即可用
   - 发件人：onboarding@resend.dev

3. **设置为北京时间早上 8 点发送**
   - 修改 CRON 为 `0 0 * * *`

---

## 🎯 下一步

**您现在可以选择：**

**选项 1: 我现在就配置邮箱**
- 告诉我您的邮箱地址
- 我帮您生成配置命令

**选项 2: 我需要注册 Resend**
- 我会详细指导您注册流程

**选项 3: 我想先测试邮件发送**
- 我会创建一个测试脚本

**选项 4: 我想使用其他邮件服务**
- 告诉我您想用什么服务

**选项 5: 我有其他问题**
- 请告诉我您的问题

---

**请告诉我您想怎么做，我会继续帮助您配置邮件服务！**
